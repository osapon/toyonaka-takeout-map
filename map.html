<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>豊中テイクアウト報道マップ（埋め込み用）</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Noto+Sans+JP:400,700" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', 'Noto Sans JP', 'ヒラギノ角ゴ ProN', 'Hiragino Kaku Gothic ProN', 'メイリオ', Meiryo, 'ＭＳ Ｐゴシック', 'MS PGothic', sans-serif;
            height:100vh;
            margin:0;
            padding:0;
        }
        #map{
            width:100%;
            height:100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script>
    fetch('toyonaka_takeout_data.json')
    .then(response => response.json())
    .then(takeout_data => {
        let geoJsonData = {
            "type": "FeatureCollection",
            "features": takeout_data.data
        };
        let updatetime_ele = parent.document.querySelector('#updatetime');
        if (updatetime_ele) updatetime_ele.innerHTML = takeout_data.updatetime;

        let tiles = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://peraichi.com/landing_pages/view/toyonaka2020ouen" target="_blank">豊中テイクアウト報道</a> | &copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors'
        });

        let map = L.map('map')
                .addLayer(tiles);

        let markers = L.markerClusterGroup({maxClusterRadius:40});

        let geoJsonLayer = L.geoJson(geoJsonData, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.popup);
            }
        });
        markers.addLayer(geoJsonLayer);

        map.addLayer(markers);
        map.fitBounds(markers.getBounds());
    });
</script>

</body>
</html>